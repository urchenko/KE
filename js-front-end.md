# WebWorkers

Нужны для выполнения определенного кода в других урезанных потоках ОС

Спецификация **«Web Workers»1** со всеми мерами предосторожности ослабляет ограничение на единственный поток выполнения в клиентском JavaScript. «Фоновые потоки», определяемые спецификацией, фактически являются параллельными потоками выполнения. Однако эти потоки выполняются в изолированной
среде, не имеют доступа к объектам Window и Document и могут взаимодействовать
>1 Спецификация «Web Workers» изначально была частью спецификации HTML5, но затем была выделена в отдельный, независимый, хотя и тесно связанный со стандартом,
документ. На момент написания этих строк проект спецификации был доступен по адресам http://dev.w3.org/html5/workers/ и http://whatwg.org/ww.

Как и любой прикладной интерфейс поддержки многопоточных приложений,
спецификация «Web Workers» определяет две различные части:

- Первая – объект Worker, который представляет фоновый поток выполнения в программе, создавшей его.

- Вторая – объект WorkerGlobalScope, глобальный объект нового фонового потока выполнения, который представляет фоновый поток выполнения внутри него самого. Оба объекта описываются в следующих подразделах. За ними следует раздел с примерами.

Чтобы создать новый фоновый поток, достаточно просто вызвать конструктор
**Worker()**, передав ему URL-адрес, определяющий программный код на языке JavaScript, который должен выполняться в фоновом потоке:

```javascript
    var ­loader­=­new­Worker("utils/loader.js");
```

Если указать относительный URL-адрес, он будет интерпретироваться относительно URL-адреса документа, содержащего сценарий, который вызвал конструктор Worker(). Если указать абсолютный URL-адрес, он должен иметь то же происхождение (протокол, имя хоста и порт), что и вмещающий документ.
После создания объекта Worker ему можно отправлять данные с помощью его метода postMessage(). Значение, переданное методу postMessage(), будет скопировано
(смотрите врезку «Структурированные копии» выше), и полученная копия будет
передана фоновому потоку вместе с событием «message»:
loader.postMessage("file.txt");
Обратите внимание, что, в отличие от метода postMessage() объекта Window, метод
postMessage() объекта Worker не имеет аргумента, в котором передавалась бы строка, описывающая происхождение (раздел 22.3). Кроме того, метод postMessage()
объекта Worker корректно копирует сообщение во всех текущих броузерах, в отличие от Window.postMessage(), который в некоторых основных броузерах способен
принимать только строковые сообщения.
Принимать сообщения от фонового потока можно с помощью обработчика события «message» объекта Worker:

```javascript
worker.onmessage ­= ­function(e) ­{
­­­­    var­ message­ = ­e.data;­ ­­­­­­­­­­­­­­­­­­­//­Из­влечь­со­об­ще­ние
­­­­    console.log("Со­дер­жи­мое:­"­+­message) //­Вы­пол­нить ­не­ко­то­рые дей­ст­вия
}
```

Если фоновый поток возбудит исключение и не обработает его, это исключение
продолжит распространение в виде события, которое также можно перехватить:

```javascript
worker.onerror­ =­ function(e) ­{
­­­­    //­Вы­вес­ти­текст­ошиб­ки,­вклю­чая­имя­фай­ла­фо­но­во­го­по­то­ка­и­но­мер­стро­ки
­­­­    console.log("Ошиб­ка­в­"­+­e.filename­+­":"­+­e.lineno­+­":­"­+­e.message);
}
```

Подобно всем объектам, в которых могут возбуждаться события, объект Worker
определяет стандартные методы addEventListener() и removeEventListener(), которые можно использовать вместо свойств onmessage и onerror, если необходимо установить несколько обработчиков событий.
Объект Worker имеет еще один метод, terminate(), который останавливает выполнение фонового потока.